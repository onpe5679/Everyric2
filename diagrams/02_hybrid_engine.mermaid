%%{init: {'theme': 'base'}}%%
flowchart TD
    subgraph HYBRID["HybridEngine.align()"]
        A[시작] --> B[_transcription_sets = 빈 리스트]
        B --> C{MFA 사용 가능?}
        
        C -->|No| D[WhisperX만 실행]
        D --> E[결과 반환]
        
        C -->|Yes| F[ThreadPoolExecutor 생성]
        
        subgraph PARALLEL["병렬 실행"]
            direction LR
            G[WhisperX 스레드]
            H[MFA 스레드]
        end
        
        F --> G
        F --> H
        
        G --> I[whisperx... → whisperx ✓]
        H --> J[mfa... → mfa ✓]
        
        I --> K[as_completed 대기]
        J --> K
        
        K --> L[transcription_sets 수집]
        L --> M{MFA 성공?}
        
        M -->|Yes| N[MFA 결과 반환]
        M -->|No| O[WhisperX 결과 반환]
    end

    subgraph STATUS["진행률 표시"]
        P["[whisperx... | mfa...]"]
        Q["[whisperx ✓ | mfa...]"]
        R["[whisperx ✓ | mfa ✓]"]
    end
